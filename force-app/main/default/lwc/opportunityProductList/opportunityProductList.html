<template>
  <lightning-card
    title="Opportunités produits / Opportunity Products"
    icon-name="standard:opportunity"
    class="slds-icon-standard-opportunity"
  >
    <div class="slds-p-around_small">
      <template if:true={showWarningMessage}>
        <div
          class="slds-notify slds-notify_alert slds-alert_warning slds-m-bottom_medium"
        >
          <p class="slds-text-color_default slds-text-align_left">
            Vous avez au moins une ligne avec un problème de quantité, veuillez
            supprimer cette ligne ou réduire sa quantité. <br />
            Si vous avez absolument besoin de plus de produits, veuillez
            contacter votre administrateur système.
          </p>
        </div>
      </template>
      <template if:true={products.length}>
        <lightning-datatable
          key-field="id"
          data={products}
          columns={columns}
          onrowaction={handleRowAction}
        >
          >
        </lightning-datatable>
        <template if:false={hasProductsOnOpportunity}>
          <p class="slds-text-color_error">{noProductMessage}</p>
        </template>
      </template>

      <!-- Aucun produit affiché sur la page -->
      <template if:false={products.length}>
        <p>
          Vous n'avez aucune ligne de produits pour le moment. <br />
          1. Veuillez tout d'abord sélectionner un Catalogue (Pricebook) <br />
          2. Sélectionnez ensuite les produits à ajouter.
        </p>
      </template>

      <template if:true={error}>
        <p class="slds-text-color_error">
          Une erreur est survenue lors de la récupération des produits :
          {error.message}
        </p>
      </template>
    </div>
  </lightning-card>
</template>
